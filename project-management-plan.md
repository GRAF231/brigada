# План разработки функциональности управления проектами

## Обзор

Функциональность управления проектами является ключевой частью сервиса для управления ремонтом квартир. Она позволяет создавать проекты, просматривать их, редактировать и добавлять участников.

## Серверная часть

### 1. Контроллер проектов (ProjectController)

Создать файл `server/src/controllers/projectController.ts` со следующими функциями:

- **createProject** - создание нового проекта
  - Принимает данные проекта (название, адрес, даты начала и окончания)
  - Создает проект в базе данных
  - Связывает проект с заказчиком и менеджером (НеБригадиром)
  - Возвращает созданный проект

- **getProjects** - получение списка проектов
  - Для менеджера (НеБригадира) - все проекты
  - Для других ролей - только проекты, в которых пользователь участвует
  - Поддержка фильтрации и сортировки

- **getProjectById** - получение проекта по ID
  - Проверка прав доступа к проекту
  - Возвращает детальную информацию о проекте

- **updateProject** - обновление проекта
  - Проверка прав доступа (только менеджер или заказчик)
  - Обновление данных проекта
  - Возвращает обновленный проект

- **addProjectUser** - добавление пользователя в проект
  - Проверка прав доступа (только менеджер)
  - Добавление пользователя в проект
  - Возвращает обновленный список участников проекта

- **removeProjectUser** - удаление пользователя из проекта
  - Проверка прав доступа (только менеджер)
  - Удаление пользователя из проекта
  - Возвращает обновленный список участников проекта

### 2. Маршруты API (ProjectRoutes)

Создать файл `server/src/routes/projectRoutes.ts` со следующими маршрутами:

- **POST /api/projects** - создание проекта
- **GET /api/projects** - получение списка проектов
- **GET /api/projects/:id** - получение проекта по ID
- **PUT /api/projects/:id** - обновление проекта
- **POST /api/projects/:id/users** - добавление пользователя в проект
- **DELETE /api/projects/:id/users/:userId** - удаление пользователя из проекта

### 3. Обновление файла index.ts

Добавить маршруты проектов в основной файл сервера:

```typescript
// Маршруты API
app.use('/api/users', userRoutes);
app.use('/api/projects', projectRoutes);
```

## Клиентская часть

### 1. Redux Slice для проектов

Создать файл `client/src/features/projects/projectSlice.ts`:

- **Состояние**:
  - projects: список проектов
  - project: текущий проект
  - loading: статус загрузки
  - error: ошибка

- **Thunk-действия**:
  - fetchProjects: получение списка проектов
  - fetchProjectById: получение проекта по ID
  - createProject: создание проекта
  - updateProject: обновление проекта
  - addProjectUser: добавление пользователя в проект
  - removeProjectUser: удаление пользователя из проекта

### 2. Компоненты React

#### Страница списка проектов

Создать файл `client/src/pages/ProjectsPage.tsx`:
- Отображение списка проектов в виде карточек
- Фильтрация и сортировка проектов
- Кнопка создания нового проекта (для менеджера и заказчика)

#### Страница создания проекта

Создать файл `client/src/pages/CreateProjectPage.tsx`:
- Форма с полями: название, адрес, дата начала, дата окончания
- Выбор заказчика (для менеджера)
- Кнопка создания проекта

#### Страница деталей проекта

Создать файл `client/src/pages/ProjectDetailsPage.tsx`:
- Отображение информации о проекте
- Вкладки для перехода к смете, графику работ и статусам
- Список участников проекта
- Кнопка редактирования проекта (для менеджера и заказчика)

#### Страница редактирования проекта

Создать файл `client/src/pages/EditProjectPage.tsx`:
- Форма с предзаполненными полями проекта
- Возможность добавления и удаления участников проекта (для менеджера)
- Кнопка сохранения изменений

### 3. Обновление маршрутов

Обновить файл `client/src/App.tsx`, добавив новые маршруты:

```tsx
{/* Маршруты для проектов */}
<Route element={<ProtectedRoute />}>
  <Route path="/projects" element={<ProjectsPage />} />
  <Route path="/projects/new" element={<CreateProjectPage />} />
  <Route path="/projects/:id" element={<ProjectDetailsPage />} />
  <Route path="/projects/:id/edit" element={<EditProjectPage />} />
</Route>
```

## План реализации

### Этап 1: Серверная часть
1. Создать контроллер проектов
2. Создать маршруты API
3. Обновить основной файл сервера
4. Протестировать API с помощью Postman или аналогичного инструмента

### Этап 2: Клиентская часть
1. Создать Redux Slice для проектов
2. Создать компоненты для работы с проектами
3. Обновить маршруты в приложении
4. Протестировать функциональность в браузере

### Этап 3: Тестирование и отладка
1. Проверить работу всех функций
2. Исправить найденные ошибки
3. Оптимизировать производительность

## Ожидаемый результат

После реализации этого плана пользователи смогут:
- Создавать новые проекты
- Просматривать список своих проектов
- Просматривать детали проекта
- Редактировать проекты
- Добавлять и удалять участников проекта

Это создаст основу для дальнейшей разработки функциональности смет, графика работ и статусов проекта.